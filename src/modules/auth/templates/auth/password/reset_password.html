<!-- üìÑ modules/auth/templates/auth/password/reset_password.html -->
<!-- üïí Last updated: 2025-07-05 16:18 -->
<!-- üìù
     ‚Ä¢ TH√äM hidden <input name="csrf_token"> trong form (Double-Submit CSRF).
     ‚Ä¢ Kh√¥ng ƒë·ªïi logic JS highlight l·ªói.
-->

{% extends "partials/auth_base.html" %}

{% block title %}TvuMoE - ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u{% endblock %}

{% block form %}
{% if request.headers.get("hx-request") == "true" %}
<title hx-swap-oob="true">TvuMoE - ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u</title>
{% endif %}

<section class="space-y-5 px-6 text-[90%]">
    <!-- ‚ñ∏ Ti√™u ƒë·ªÅ -->
    <header class="text-center space-y-1">
        <h2 class="text-2xl font-semibold">ƒê·∫∑t l·∫°i m·∫≠t kh·∫©u</h2>
        <p class="text-sm text-gray-600">
            Nh·∫≠p m·∫≠t kh·∫©u m·ªõi cho t√†i kho·∫£n c·ªßa b·∫°n.
        </p>
    </header>

    <!-- ‚ñ∏ FORM -->
    <form class="space-y-4" method="post" action="/auth/reset-password" hx-post="/auth/reset-password" hx-target="#msg"
        hx-swap="innerHTML">

        <!-- üîê CSRF token -->
        <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />

        <!-- Token reset ·∫©n -->
        <input type="hidden" name="token" value="{{ token }}" />

        <!-- M·∫≠t kh·∫©u m·ªõi -->
        <div class="relative">
            <input id="new_password" name="password" type="password" required placeholder=" " class="peer w-full rounded-full border border-gray-300 px-5 py-2.5 placeholder-transparent
                          focus:outline-none focus:border-[#053484]" />
            <label for="new_password" class="absolute left-5 -top-3 bg-white px-[4px] text-xs text-gray-500 transition-all
                          peer-placeholder-shown:top-2.5 peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-400
                          peer-focus:-top-2 peer-focus:text-xs peer-focus:text-[#053484]">
                M·∫≠t kh·∫©u m·ªõi
            </label>
        </div>

        <!-- X√°c nh·∫≠n m·∫≠t kh·∫©u -->
        <div class="relative">
            <input id="confirm_password" name="confirm_password" type="password" required placeholder=" " class="peer w-full rounded-full border border-gray-300 px-5 py-2.5 placeholder-transparent
                          focus:outline-none focus:border-[#053484]" />
            <label for="confirm_password" class="absolute left-5 -top-3 bg-white px-[4px] text-xs text-gray-500 transition-all
                          peer-placeholder-shown:top-2.5 peer-placeholder-shown:text-base peer-placeholder-shown:text-gray-400
                          peer-focus:-top-2 peer-focus:text-xs peer-focus:text-[#053484]">
                Nh·∫≠p l·∫°i m·∫≠t kh·∫©u m·ªõi
            </label>
        </div>

        <!-- N√∫t x√°c nh·∫≠n -->
        <button type="submit" class="w-full rounded-full bg-black py-2.5 text-white font-medium hover:opacity-90">
            X√°c nh·∫≠n
        </button>
    </form>

    <!-- ‚ñ∏ Th√¥ng b√°o l·ªói s·∫Ω swap v√†o ƒë√¢y -->
    <div id="msg" class="text-center text-red-600 text-sm"></div>

    <!-- ‚ñ∏ Quay l·∫°i ƒêƒÉng nh·∫≠p -->
    <p class="text-center text-sm">
        <a href="/auth/login" class="text-blue-600 hover:underline">Quay l·∫°i ƒêƒÉng nh·∫≠p</a>
    </p>
</section>

<!-- JS: b√¥i ƒë·ªè border khi c√≥ l·ªói HTMX tr·∫£ v·ªÅ -->
<script>
    document.body.addEventListener('htmx:afterSwap', e => {
        if (e.detail.target.id !== 'msg') return;
        const txt = (e.detail.target.textContent || '').toLowerCase();
        const pw = document.getElementById('new_password');
        const pw2 = document.getElementById('confirm_password');
        [pw, pw2].forEach(el => el.classList.remove('border-red-500'));

        if (txt.includes('√≠t nh·∫•t 6')) pw.classList.add('border-red-500');
        if (txt.includes('m·ªôt s·ªë')) pw.classList.add('border-red-500');
        if (txt.includes('k√Ω t·ª± ƒë·∫∑c bi·ªát')) pw.classList.add('border-red-500');
        if (txt.includes('hai m·∫≠t kh·∫©u')) { pw.classList.add('border-red-500'); pw2.classList.add('border-red-500'); }
        if (txt.includes('nh·∫≠p m·∫≠t kh·∫©u')) pw.classList.add('border-red-500');
    });
</script>
{% endblock %}