<!-- üìÑ File: src/modules/auth/templates/auth/password/forgot_password_sent.html -->
<!-- üïí Last updated: 2025-07-01 17:50 -->
<!-- üìù 
  ‚Ä¢ S·ª≠a ƒë∆∞·ªùng d·∫´n extends th√†nh "partials/auth_base.html"
  ‚Ä¢ C·∫≠p nh·∫≠t th·ªùi gian h·∫øt h·∫°n token trong th√¥ng b√°o th√†nh 5 ph√∫t
-->
{% extends "partials/auth_base.html" %}

{% block title %}TvuMoE - Ki·ªÉm tra email{% endblock %}

{% block form %}
<title hx-swap-oob="true">TvuMoE - Ki·ªÉm tra email</title>

<section class="space-y-5 px-6 text-[90%]">
    <!-- ‚ñ∏ Ti√™u ƒë·ªÅ -->
    <h2 class="text-2xl font-semibold text-green-700 text-center">
        Ki·ªÉm tra h·ªôp th∆∞ c·ªßa b·∫°n
    </h2>

    <!-- ‚ñ∏ N·ªôi dung th√¥ng b√°o -->
    <p class="text-sm text-gray-600 text-center leading-relaxed">
        N·∫øu email t·ªìn t·∫°i trong h·ªá th·ªëng, ch√∫ng t√¥i ƒë√£ g·ª≠i cho b·∫°n m·ªôt li√™n k·∫øt ƒë·ªÉ ƒë·∫∑t l·∫°i m·∫≠t kh·∫©u.
        <br>Vui l√≤ng ki·ªÉm tra th∆∞ v√† l√†m theo h∆∞·ªõng d·∫´n<br>(li√™n k·∫øt h·∫øt h·∫°n sau 5 ph√∫t).
    </p>

    <!-- ‚ñ∏ Link h·ªó tr·ª£ -->
    <div class="text-center text-sm space-y-1">
        <p>
            <a id="resend-link" href="/auth/forgot-password" class="text-green-700 hover:underline">
                Kh√¥ng th·∫•y email? G·ª≠i l·∫°i
            </a>
        </p>
        <p>
            <a href="/auth/login" class="text-blue-600 hover:underline">
                Quay l·∫°i ƒêƒÉng nh·∫≠p
            </a>
        </p>
    </div>
</section>

<script>
    /* ===== Ch·ªëng spam ‚ÄúG·ª≠i l·∫°i‚Äù (localStorage) ==================== */
    (() => {
        const link = document.getElementById('resend-link');
        if (!link) return;

        const KEY_WAIT = 'fp_wait';        // th·ªùi gian ch·ªù cho l·∫ßn t·ªõi (s)
        const KEY_END = 'fp_wait_until';   // epoch ms khi h·∫øt ch·ªù

        const now = Date.now();
        let wait = +(localStorage.getItem(KEY_WAIT) || 60);      // m·∫∑c ƒë·ªãnh 60 s
        let end = +(localStorage.getItem(KEY_END) || 0);

        // N·∫øu c√≤n ch·ªù ‚Üí disable & ƒë·∫øm ng∆∞·ª£c
        if (end > now) {
            disable(link);
            countdown(Math.ceil((end - now) / 1000));
        }

        // Khi click ‚ÄúG·ª≠i l·∫°i‚Äù
        link.addEventListener('click', (e) => {
            if (link.dataset.disabled === '1') {  // ch∆∞a h·∫øt ch·ªù
                e.preventDefault();
                return;
            }
            const nextWait = wait * 2;           // √ó2
            localStorage.setItem(KEY_WAIT, nextWait);
            localStorage.setItem(KEY_END, Date.now() + nextWait * 1000);
            // (chuy·ªÉn sang form /auth/forgot-password nh∆∞ b√¨nh th∆∞·ªùng)
        });

        /* Helpers -------------------------------------------------- */
        function disable(el) {
            el.dataset.disabled = '1';
            el.classList.add('opacity-50', 'cursor-not-allowed');
            el.classList.remove('hover:underline');
        }

        function enable(el) {
            delete el.dataset.disabled;
            el.classList.remove('opacity-50', 'cursor-not-allowed');
            el.classList.add('hover:underline');
            el.textContent = 'Kh√¥ng th·∫•y email? G·ª≠i l·∫°i';
        }

        function countdown(sec) {
            link.textContent = `Kh√¥ng th·∫•y email? G·ª≠i l·∫°i sau ${sec}s`;
            if (sec <= 0) {
                enable(link);
                return;
            }
            setTimeout(() => countdown(sec - 1), 1000);
        }
    })();
</script>
{% endblock %}