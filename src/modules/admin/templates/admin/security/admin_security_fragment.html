<title hx-swap-oob="true">Qu·∫£n l√Ω h·ªá th·ªëng</title>
<!-- üìÑ src/modules/admin/templates/admin/security/admin_security_fragment.html -->
<!-- üïí Updated: 2025-07-09 21:30 ‚Äì Lo·∫°i b·ªè ph·∫ßn Th√¥ng b√°o to√†n h·ªá th·ªëng -->
<form id="admin-security-form" hx-post="/admin/security" hx-target="#admin-security-form" hx-swap="outerHTML"
    class="space-y-6">
    <input type="hidden" name="csrf_token" value="{{ csrf_token }}" />

    <!-- Cho ph√©p ƒëƒÉng k√Ω -->
    <div class="flex items-center">
        <input id="system_register" name="system_register" type="checkbox" class="h-4 w-4 text-blue-600 peer" {% if
            settings.system_register %}checked{% endif %} />
        <label for="system_register" class="ml-2 text-gray-700 select-none">Cho ph√©p ƒëƒÉng k√Ω</label>
    </div>

    <!-- B·∫Øt bu·ªôc login OAuth -->
    <div class="flex items-center">
        <input id="system_login" name="system_login" type="checkbox" class="h-4 w-4 text-blue-600 peer" {% if
            settings.system_login %}checked{% endif %} />
        <label for="system_login" class="ml-2 text-gray-700 select-none">B·∫Øt bu·ªôc ƒëƒÉng nh·∫≠p OAuth</label>
    </div>

    <!-- Ch·∫ø ƒë·ªô b·∫£o tr√¨ -->
    <div class="flex items-center">
        <input id="system_maintenance" name="system_maintenance" type="checkbox" class="h-4 w-4 text-red-600 peer" {% if
            settings.system_maintenance %}checked{% endif %} />
        <label for="system_maintenance" class="ml-2 text-gray-700 select-none">B·∫≠t ch·∫ø ƒë·ªô b·∫£o tr√¨</label>
    </div>

    <!-- Gi·ªõi h·∫°n domain OAuth -->
    <div>
        <label for="system_domain_mode" class="block mb-1 text-gray-700">Gi·ªõi h·∫°n domain OAuth</label>
        <select id="system_domain_mode" name="system_domain_mode"
            class="block w-full border border-gray-300 rounded p-2">
            <option value="none" {% if settings.system_domain_mode=='none' %}selected{% endif %}>Kh√¥ng gi·ªõi h·∫°n</option>
            <option value="tvu" {% if settings.system_domain_mode=='tvu' %}selected{% endif %}>Ch·ªâ @tvu.edu.vn</option>
            <option value="tvu_and_sttvu" {% if settings.system_domain_mode=='tvu_and_sttvu' %}selected{% endif %}>
                @tvu.edu.vn v√† @st.tvu.edu.vn
            </option>
        </select>
    </div>

    <!-- Submit -->
    <div class="flex justify-end">
        <button type="submit" class="px-4 py-2 bg-green-600 text-white rounded hover:bg-green-700">
            L∆∞u thay ƒë·ªïi
        </button>
    </div>
</form>

<script>
    document.addEventListener('htmx:load', attachSecurityFormLogic);
    attachSecurityFormLogic();
    function attachSecurityFormLogic() {
        const form = document.getElementById('admin-security-form');
        if (!form) return;
        const chkRegister = form.querySelector('#system_register');
        const chkLogin = form.querySelector('#system_login');
        const chkMaintenance = form.querySelector('#system_maintenance');

        toggleAB();
        chkMaintenance.addEventListener('change', toggleAB);
        chkRegister.addEventListener('change', ensureAtLeastOneAB);
        chkLogin.addEventListener('change', ensureAtLeastOneAB);

        function toggleAB() {
            const isM = chkMaintenance.checked;
            chkRegister.disabled = chkLogin.disabled = isM;
            chkRegister.parentElement.classList.toggle('opacity-50', isM);
            chkLogin.parentElement.classList.toggle('opacity-50', isM);
        }
        function ensureAtLeastOneAB(e) {
            if (chkMaintenance.checked) return;
            if (!chkRegister.checked && !chkLogin.checked) {
                e.target.checked = true;
                alert('Ph·∫£i b·∫≠t √≠t nh·∫•t ‚ÄúCho ph√©p ƒëƒÉng k√Ω‚Äù ho·∫∑c ‚ÄúB·∫Øt bu·ªôc ƒëƒÉng nh·∫≠p OAuth‚Äù.');
            }
        }
    }
</script>