<title hx-swap-oob="true">Quản lý mô hình AI</title>
<!-- file: src/modules/admin/templates/admin/models/admin_models_fragment.html -->
<!-- updated: 2025-08-23 (v1.6 – Toolbar 2 dòng + Bulk retire btn + OOB <title>) -->
<!-- note: Fragment HTMX cho trang "Mô hình AI" – toolbar + list + paging + bulk -->

{% set _sort_map = {
'new':'Mới nhất','old':'Cũ nhất','az':'Tên A–Z','za':'Tên Z–A','prov_az':'Nhà cung cấp A–Z','prov_za':'Nhà cung cấp Z–A'
} %}
{% set sort_key = (current_sort or 'new') %}
{% set sort_label = _sort_map.get(sort_key, 'Mới nhất') %}

{# QS base (không kèm per_page; JS sẽ bơm) #}
{% set qs_base -%}
status={{ (filter_status or 'all') }}&scope={{ (filter_scope or 'any') }}&tier={{ (filter_tier or 'all') }}&enabled={{ (filter_enabled or 'all') }}{% if filter_provider %}&provider={{ filter_provider|urlencode }}{% endif %}{% if filter_type %}&type={{ filter_type|urlencode }}{% endif %}{% if filter_q %}&q={{ filter_q|urlencode }}{% endif %}&sort={{ (filter_sort or 'created_desc') }}
{%- endset %}

<div id="admin-models-container"
    class="w-full min-w-0 flex flex-col pl-4 pr-4 pt-4 pb-4"
    data-current-sort="{{ sort_key }}"
    data-status="{{ filter_status or 'all' }}"
    data-scope="{{ filter_scope or 'any' }}"
    data-tier="{{ filter_tier or 'all' }}"
    data-enabled="{{ filter_enabled or 'all' }}"
    data-provider="{{ filter_provider or '' }}"
    data-type="{{ filter_type or '' }}"
    data-page="{{ page or 1 }}"
    data-per-page="{{ per_page or 10 }}"
    data-total="{{ total or 0 }}"
    data-total-pages="{{ total_pages or 1 }}">

    <!-- Toolbar -->
    <div id="models-toolbar" class="w-full min-w-0 space-y-3">
        <!-- ROW 1: 3 ô tìm kiếm -->
        <div class="flex flex-wrap items-center gap-3">
            <!-- Search by name -->
            <form id="models-search-form"
                class="relative w-full max-w-[360px]"
                hx-get="/admin/models"
                hx-target="#models-list-region"
                hx-select="#models-list-region"
                hx-swap="outerHTML"
                hx-push-url="true"
                hx-sync="this:replace">
                <input id="models-search-input"
                    name="q"
                    type="search"
                    inputmode="search"
                    placeholder="Tìm theo tên mô hình…"
                    value="{{ (filter_q or '')|e }}"
                    class="w-full h-[45px] pl-11 pr-3 rounded-full bg-white ring-1 ring-gray-200 focus:ring-2 focus:ring-blue-700 outline-none text-sm text-gray-900 placeholder:text-gray-400"
                    hx-trigger="input changed delay:250ms, search">
                <span class="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 pointer-events-none">
                    <span class="icon-search-default block">{% include "partials/icons/admin/system/icons_admin_setting_tim_kiem_den.svg" %}</span>
                </span>

                {# giữ trạng thái filter/sort/paging #}
                <input type="hidden" name="status" value="{{ filter_status or 'all' }}">
                <input type="hidden" name="scope" value="{{ filter_scope or 'any' }}">
                <input type="hidden" name="tier" value="{{ filter_tier or 'all' }}">
                <input type="hidden" name="enabled" value="{{ filter_enabled or 'all' }}">
                <input type="hidden" name="provider" value="{{ filter_provider or '' }}">
                <input type="hidden" name="type" value="{{ filter_type or '' }}">
                <input type="hidden" name="sort" value="{{ filter_sort or 'created_desc' }}">
                <input type="hidden" name="page" value="{{ page or 1 }}">
                <input type="hidden" name="per_page" value="{{ per_page or 10 }}">
            </form>

            <!-- Quick provider -->
            <form id="models-provider-form"
                class="relative w-[220px] hidden md:block"
                hx-get="/admin/models"
                hx-target="#models-list-region"
                hx-select="#models-list-region"
                hx-swap="outerHTML"
                hx-push-url="true"
                hx-sync="this:replace">
                <input name="provider"
                    type="text"
                    placeholder="Lọc theo nhà cung cấp…"
                    value="{{ (filter_provider or '')|e }}"
                    class="w-full h-[45px] px-4 rounded-full bg-white ring-1 ring-gray-200 focus:ring-2 focus:ring-blue-700 outline-none text-sm text-gray-900 placeholder:text-gray-400"
                    hx-trigger="change delay:200ms, keyup changed delay:500ms">
                <input type="hidden" name="status" value="{{ filter_status or 'all' }}">
                <input type="hidden" name="scope" value="{{ filter_scope or 'any' }}">
                <input type="hidden" name="tier" value="{{ filter_tier or 'all' }}">
                <input type="hidden" name="enabled" value="{{ filter_enabled or 'all' }}">
                <input type="hidden" name="q" value="{{ filter_q or '' }}">
                <input type="hidden" name="type" value="{{ filter_type or '' }}">
                <input type="hidden" name="sort" value="{{ filter_sort or 'created_desc' }}">
                <input type="hidden" name="page" value="{{ page or 1 }}">
                <input type="hidden" name="per_page" value="{{ per_page or 10 }}">
            </form>

            <!-- Quick type -->
            <form id="models-type-form"
                class="relative w-[200px] hidden lg:block"
                hx-get="/admin/models"
                hx-target="#models-list-region"
                hx-select="#models-list-region"
                hx-swap="outerHTML"
                hx-push-url="true"
                hx-sync="this:replace">
                <input name="type"
                    type="text"
                    placeholder="Loại (chat/vision/…)…"
                    value="{{ (filter_type or '')|e }}"
                    class="w-full h-[45px] px-4 rounded-full bg-white ring-1 ring-gray-200 focus:ring-2 focus:ring-blue-700 outline-none text-sm text-gray-900 placeholder:text-gray-400"
                    hx-trigger="change delay:200ms, keyup changed delay:500ms">
                <input type="hidden" name="status" value="{{ filter_status or 'all' }}">
                <input type="hidden" name="scope" value="{{ filter_scope or 'any' }}">
                <input type="hidden" name="tier" value="{{ filter_tier or 'all' }}">
                <input type="hidden" name="enabled" value="{{ filter_enabled or 'all' }}">
                <input type="hidden" name="q" value="{{ filter_q or '' }}">
                <input type="hidden" name="provider" value="{{ filter_provider or '' }}">
                <input type="hidden" name="sort" value="{{ filter_sort or 'created_desc' }}">
                <input type="hidden" name="page" value="{{ page or 1 }}">
                <input type="hidden" name="per_page" value="{{ per_page or 10 }}">
            </form>
        </div>

        <!-- ROW 2: Bộ lọc (trái) — Sort/CSV/Tạo (phải) -->
        <div class="flex flex-wrap items-center justify-between gap-3">
            <!-- LEFT: Filter -->
            <div class="flex items-center gap-3">
                <div class="relative">
                    <button id="btn-models-filter" type="button" aria-haspopup="menu" aria-expanded="false"
                        class="inline-flex items-center h-[45px] px-4 rounded-full bg-white ring-1 ring-gray-300 hover:ring-blue-700 focus:ring-blue-700 text-sm font-medium text-gray-900 hover:text-blue-700 focus:text-blue-700 gap-2 w-auto">
                        <span class="w-5 h-5 inline-flex items-center justify-center relative">
                            <span class="icon-filter-default block">{% include "partials/icons/admin/system/icons_admin_filter_den.svg" %}</span>
                            <span class="icon-filter-hover block absolute inset-0 pointer-events-none">{% include "partials/icons/admin/system/icons_admin_filter_xanh.svg" %}</span>
                        </span>
                        <span>Bộ lọc</span>
                    </button>

                    <div id="menu-models-filter"
                        role="menu"
                        aria-labelledby="btn-models-filter"
                        class="hidden absolute z-20 mt-2 min-w-[320px] rounded-xl bg-white border border-gray-200 shadow-xl p-2">
                        <div class="grid grid-cols-2 gap-2">
                            <!-- Status -->
                            <div>
                                <div class="text-xs font-semibold text-gray-500 mb-1">Trạng thái</div>
                                <div class="flex flex-wrap gap-1">
                                    {% for s in ['all','active','preview','deprecated','retired'] %}
                                    <button type="button" role="menuitem" class="menu-item px-3 py-1.5 rounded-full ring-1 ring-gray-200 text-sm {% if (filter_status or 'all')==s %}bg-blue-50 text-blue-800 ring-blue-300{% else %}bg-white text-gray-900 hover:ring-blue-600{% endif %}"
                                        data-k="status" data-v="{{ s }}">{{ s }}</button>
                                    {% endfor %}
                                </div>
                            </div>

                            <!-- Enabled -->
                            <div>
                                <div class="text-xs font-semibold text-gray-500 mb-1">Kích hoạt</div>
                                <div class="flex flex-wrap gap-1">
                                    {% for e in ['all','enabled','disabled'] %}
                                    <button type="button" role="menuitem" class="menu-item px-3 py-1.5 rounded-full ring-1 ring-gray-200 text-sm {% if (filter_enabled or 'all')==e %}bg-blue-50 text-blue-800 ring-blue-300{% else %}bg-white text-gray-900 hover:ring-blue-600{% endif %}"
                                        data-k="enabled" data-v="{{ e }}">{{ e }}</button>
                                    {% endfor %}
                                </div>
                            </div>

                            <!-- Scope -->
                            <div>
                                <div class="text-xs font-semibold text-gray-500 mb-1">Phạm vi</div>
                                <div class="flex flex-wrap gap-1">
                                    {% for sc in ['any','all','user','internal','admin'] %}
                                    <button type="button" role="menuitem" class="menu-item px-3 py-1.5 rounded-full ring-1 ring-gray-200 text-sm {% if (filter_scope or 'any')==sc %}bg-blue-50 text-blue-800 ring-blue-300{% else %}bg-white text-gray-900 hover:ring-blue-600{% endif %}"
                                        data-k="scope" data-v="{{ sc }}">{{ sc }}</button>
                                    {% endfor %}
                                </div>
                            </div>

                            <!-- Tier -->
                            <div>
                                <div class="text-xs font-semibold text-gray-500 mb-1">Tầng</div>
                                <div class="flex flex-wrap gap-1">
                                    {% for t in ['all','auto','low','medium','high'] %}
                                    <button type="button" role="menuitem" class="menu-item px-3 py-1.5 rounded-full ring-1 ring-gray-200 text-sm {% if (filter_tier or 'all')==t %}bg-blue-50 text-blue-800 ring-blue-300{% else %}bg-white text-gray-900 hover:ring-blue-600{% endif %}"
                                        data-k="tier" data-v="{{ t }}">{{ t }}</button>
                                    {% endfor %}
                                </div>
                            </div>
                        </div>

                        <div class="mt-2 flex items-center justify-end gap-2">
                            <button id="btn-models-reset"
                                type="button"
                                class="inline-flex items-center h-[38px] px-3 rounded-full text-sm font-semibold"
                                style="color:#1E3A8A">
                                <span class="w-5 h-5 inline-flex items-center justify-center mr-1">{% include "partials/icons/admin/system/icons_admin_reset_xanh.svg" %}</span>
                                <span>Đặt lại</span>
                            </button>
                            <button id="btn-models-apply"
                                type="button"
                                class="h-[38px] px-4 rounded-full bg-blue-900 text-white text-sm font-medium hover:bg-blue-800">Áp dụng</button>
                        </div>
                    </div>
                </div>
            </div>

            <!-- RIGHT: Sort, CSV, New -->
            <div class="flex items-center gap-3">
                <!-- Sort -->
                <div class="relative">
                    <button id="btn-models-sort" type="button" aria-haspopup="menu" aria-expanded="false"
                        class="flex items-center h-[45px] px-4 rounded-full bg-white ring-1 ring-gray-300 hover:ring-blue-700 focus:ring-blue-700 text-sm font-medium text-gray-900 hover:text-blue-700 focus:text-blue-700 gap-2">
                        <span id="models-sort-label">
                            <span class="sort-prefix">Sắp xếp:&nbsp;</span>
                            <span class="sort-value">{{ sort_label }}</span>
                        </span>
                        <span class="w-[18px] h-[18px] inline-flex items-center justify-center relative">
                            <span class="icon-arrow-default block">{% include "partials/icons/admin/system/icons_admin_arrow_down_den.svg" %}</span>
                            <span class="icon-arrow-hover block absolute inset-0 pointer-events-none">{% include "partials/icons/admin/system/icons_admin_arrow_down_xanh.svg" %}</span>
                        </span>
                    </button>

                    <!-- Sort menu 2 cột – neo dưới nút -->
                    <div id="menu-models-sort" role="menu" aria-labelledby="btn-models-sort"
                        class="hidden absolute z-30 right-0 top-full translate-y-2 min-w-[360px] models-menu">
                        <div class="p-1 grid grid-cols-2 gap-1">
                            <button type="button" role="menuitem" class="menu-item" data-sort="new">Mới nhất</button>
                            <button type="button" role="menuitem" class="menu-item" data-sort="old">Cũ nhất</button>
                            <button type="button" role="menuitem" class="menu-item" data-sort="az">Tên A–Z</button>
                            <button type="button" role="menuitem" class="menu-item" data-sort="za">Tên Z–A</button>
                            <button type="button" role="menuitem" class="menu-item" data-sort="prov_az">Nhà cung cấp A–Z</button>
                            <button type="button" role="menuitem" class="menu-item" data-sort="prov_za">Nhà cung cấp Z–A</button>
                        </div>
                    </div>
                </div>

                <button id="btn-models-export-csv" type="button"
                    class="flex items-center justify-center h-[45px] px-4 rounded-full bg-white ring-1 ring-gray-300 hover:ring-blue-700 focus:ring-blue-700 font-medium text-sm leading-none text-gray-900 hover:text-blue-700 focus:text-blue-700 transition-all duration-100 focus:outline-none gap-2 shadow">
                    <span class="inline-flex items-center justify-center w-5 h-5 relative">
                        <span class="block icon-csv-default">{% include "partials/icons/admin/system/icons_admin_setting_csv_den.svg" %}</span>
                        <span class="block icon-csv-hover absolute inset-0 pointer-events-none">{% include "partials/icons/admin/system/icons_admin_setting_csv_xanh.svg" %}</span>
                    </span>
                    <span>Xuất CSV</span>
                </button>

                <button id="btn-open-models-new-modal" type="button"
                    class="flex items-center justify-center h-[45px] px-4 rounded-full bg-blue-900 text-white font-medium text-sm leading-none hover:bg-blue-800 transition-all duration-75 focus:outline-none focus:ring-2 focus:ring-blue-300 shadow gap-2">
                    <span class="inline-flex items-center justify-center w-5 h-5">{% include "partials/icons/admin/system/icons_admin_setting_dau_cong.svg" %}</span>
                    <span>Tạo mô hình mới</span>
                </button>
            </div>
        </div>
    </div>
    <!-- /Toolbar -->

    <div id="admin-models-modal-root"></div>

    <!-- LIST REGION -->
    <div id="models-list-region" class="mt-2">
        {% if not models %}
        <p class="text-gray-500 italic">Chưa có mô hình nào.</p>
        {% else %}
        <div class="w-full min-w-0 rounded-2xl overflow-hidden shadow border border-gray-200 bg-white">
            <div id="admin-models-table" class="w-full min-w-0">
                <table class="min-w-full text-sm table-fixed">
                    <colgroup>
                        <col style="width:44px">
                        <col style="width:26%">
                        <col style="width:16%">
                        <col style="width:12%">
                        <col style="width:12%">
                        <col style="width:10%">
                        <col style="width:10%">
                        <col style="width:10%">
                    </colgroup>
                    <thead class="text-left">
                        <tr class="bg-[#EEF2FF]">
                            <th class="px-4 py-2 border-b border-gray-200 text-[#1E3A8A] font-medium">
                                <label class="cb" aria-label="Chọn tất cả" id="sel-all-wrap">
                                    <input id="sel-all" type="checkbox"><span class="cb-box" aria-hidden="true"></span>
                                </label>
                            </th>
                            <th class="px-4 py-2 border-b border-gray-200 text-[#1E3A8A] font-medium">Tên mô hình</th>
                            <th class="px-4 py-2 border-b border-gray-200 text-[#1E3A8A] font-medium">Nhà cung cấp</th>
                            <th class="px-4 py-2 border-b border-gray-200 text-[#1E3A8A] font-medium">Loại</th>
                            <th class="px-4 py-2 border-b border-gray-200 text-[#1E3A8A] font-medium">Phạm vi</th>
                            <th class="px-4 py-2 border-b border-gray-200 text-[#1E3A8A] font-medium">Tầng</th>
                            <th class="px-4 py-2 border-b border-gray-200 text-[#1E3A8A] font-medium">Trạng thái</th>
                            <th class="px-3 py-2 border-b border-gray-200 text-[#1E3A8A] font-medium text-right" aria-hidden="true"></th>
                        </tr>
                    </thead>

                    <!-- DATA ROWS -->
                    <tbody id="models-tbody">
                        {% for m in models %}
                        <tr class="group">
                            <td class="px-4 py-2 border-b border-gray-200 align-top">
                                <label class="cb" aria-label="Chọn mô hình">
                                    <input type="checkbox"
                                        class="row-select"
                                        data-model-id="{{ m.model_id }}"
                                        data-enabled="{{ 1 if m.model_enabled else 0 }}"
                                        data-status="{{ m.model_status }}">
                                    <span class="cb-box" aria-hidden="true"></span>
                                </label>
                            </td>

                            <td class="px-4 py-2 border-b border-gray-200 align-top whitespace-nowrap overflow-hidden text-ellipsis">
                                <div class="font-medium text-gray-900 btn-model-detail cursor-pointer" data-model-id="{{ m.model_id }}">
                                    {{ m.model_name|e }}
                                </div>
                                {% if m.model_description %}
                                <div class="text-gray-500 line-clamp-1">{{ m.model_description }}</div>
                                {% endif %}
                                <div class="text-xs text-gray-400 mt-1">
                                    <span>Cập nhật: {{ (m.model_updated_at or m.model_created_at).astimezone().strftime('%d/%m/%Y %H:%M') }}</span>
                                    {% if m.model_sort_order is not none %} • <span>Sort: {{ m.model_sort_order }}</span>{% endif %}
                                </div>
                            </td>

                            <td class="px-4 py-2 border-b border-gray-200 align-top whitespace-nowrap text-gray-900">
                                {{ m.model_provider or '—' }}
                                {% if m.provider_model_id %}<div class="text-xs text-gray-500">{{ m.provider_model_id }}</div>{% endif %}
                                <div class="provider-state {{ 'provider-state--on' if m.model_enabled else 'provider-state--off' }}">
                                    {{ 'Đang chạy' if m.model_enabled else 'Đang tắt' }}
                                </div>
                            </td>

                            <td class="px-4 py-2 border-b border-gray-200 align-top whitespace-nowrap text-gray-900">
                                {{ m.model_type or '—' }}
                            </td>

                            <td class="px-4 py-2 border-b border-gray-200 align-top whitespace-nowrap">
                                <span class="status-pill {% if m.model_access_scope=='admin' %}status-pill--purple{% elif m.model_access_scope=='internal' %}status-pill--blue{% elif m.model_access_scope=='user' %}status-pill--slate{% else %}status-pill--gray{% endif %}">
                                    {{ m.model_access_scope }}
                                </span>
                            </td>

                            <td class="px-4 py-2 border-b border-gray-200 align-top whitespace-nowrap">
                                <span class="status-pill {% if m.model_tier=='high' %}status-pill--orange{% elif m.model_tier=='medium' %}status-pill--amber{% elif m.model_tier=='low' %}status-pill--yellow{% else %}status-pill--gray{% endif %}">
                                    {{ m.model_tier or 'auto' }}
                                </span>
                            </td>

                            <td class="px-4 py-2 border-b border-gray-200 align-top whitespace-nowrap">
                                {% if m.model_status == 'retired' %}
                                <span class="status-pill status-pill--red">retired</span>
                                {% elif m.model_status == 'deprecated' %}
                                <span class="status-pill status-pill--rose">deprecated</span>
                                {% elif m.model_status == 'preview' %}
                                <span class="status-pill status-pill--indigo">preview</span>
                                {% else %}
                                <span class="status-pill status-pill--green">active</span>
                                {% endif %}
                            </td>

                            <td class="px-3 py-2 border-b border-gray-200 align-top">
                                <div class="flex items-center justify-end gap-1.5">
                                    <button type="button"
                                        class="action-btn row-action-detail tt"
                                        aria-label="Chi tiết" data-tt="Chi tiết"
                                        data-model-id="{{ m.model_id }}">
                                        <span class="inline-flex w-[18px] h-[18px] items-center justify-center">
                                            {% include "partials/icons/admin/system/icons_admin_setting_info.svg" %}
                                        </span>
                                    </button>

                                    <button type="button"
                                        class="action-btn row-action-edit tt"
                                        aria-label="Sửa" data-tt="Sửa"
                                        data-model-id="{{ m.model_id }}">
                                        <span class="inline-flex w-[18px] h-[18px] items-center justify-center">
                                            {% include "partials/icons/admin/system/icons_admin_setting_pen_edit.svg" %}
                                        </span>
                                    </button>

                                    <button type="button"
                                        class="action-btn row-action-toggle tt"
                                        aria-label="{{ 'Tắt enabled' if m.model_enabled else 'Bật enabled' }}"
                                        data-tt="{{ 'Tắt enabled' if m.model_enabled else 'Bật enabled' }}"
                                        data-model-id="{{ m.model_id }}"
                                        data-enabled="{{ 1 if m.model_enabled else 0 }}">
                                        <span class="inline-flex w-[18px] h-[18px] items-center justify-center">
                                            {% if m.model_enabled %}
                                            {% include "partials/icons/admin/tools/icons_admin_tools_ngoisao_vang.svg" %}
                                            {% else %}
                                            {% include "partials/icons/admin/tools/icons_admin_tools_ngoisao_xanh.svg" %}
                                            {% endif %}
                                        </span>
                                    </button>

                                    <button type="button"
                                        class="action-btn row-action-delete tt"
                                        aria-label="Ngừng dùng" data-tt="Ngừng dùng (retire)"
                                        data-model-id="{{ m.model_id }}">
                                        <span class="inline-flex w-[18px] h-[18px] items-center justify-center">
                                            {% include "partials/icons/admin/system/icons_admin_setting_delete.svg" %}
                                        </span>
                                    </button>
                                </div>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>

                    <!-- SMART FILLER (JS sẽ render) -->
                    <tbody id="models-filler" aria-hidden="true"></tbody>
                </table>
            </div>

            <!-- Pagination -->
            <div id="models-pagination"
                class="flex items-center justify-between gap-3 flex-wrap bg-white border-t px-4 py-3"
                aria-label="Điều hướng trang">
                <div class="min-w-[180px]">
                    {% if show_first_btn %}
                    <button type="button"
                        class="group inline-flex items-center justify-center gap-2 h-[45px] px-4 rounded-full bg-white text-sm font-medium text-gray-900 hover:text-blue-700 shrink-0"
                        hx-get="/admin/models?page=1&{{ qs_base|trim }}"
                        hx-target="#models-list-region"
                        hx-select="#models-list-region"
                        hx-swap="outerHTML"
                        hx-push-url="true"
                        aria-controls="models-list-region">
                        <span class="relative inline-flex w-5 h-5 items-center justify-center" aria-hidden="true">
                            <span class="icon-first-default block">
                                {% include "partials/icons/admin/system/icon-admin-arrow-first-page-den-left.svg" %}
                            </span>
                            <span class="icon-first-hover block absolute inset-0 pointer-events-none">
                                {% include "partials/icons/admin/system/icon-admin-arrow-first-page-xanh-left.svg" %}
                            </span>
                        </span>
                        <span>Về trang 1</span>
                    </button>
                    {% endif %}
                </div>

                <div class="flex items-center justify-center gap-2">
                    <button type="button"
                        class="group inline-flex items-center justify-center gap-2 px-4 h-[45px] w-[150px] rounded-full bg-white ring-1 ring-gray-300 text-gray-900 hover:text-blue-700 hover:ring-blue-700 shrink-0 disabled:opacity-50 disabled:cursor-not-allowed"
                        {% if page>1 %}
                        hx-get="/admin/models?page={{ page-1 }}&{{ qs_base|trim }}"
                        hx-target="#models-list-region" hx-select="#models-list-region"
                        hx-swap="outerHTML" hx-push-url="true" aria-controls="models-list-region"
                        {% else %} disabled {% endif %}>
                        <span class="relative inline-flex w-[14px] h-[14px] items-center justify-center" aria-hidden="true">
                            <span class="block">{% include "partials/icons/admin/system/icon-admin-arrow-dai-left-den.svg" %}</span>
                            <span class="block absolute inset-0 opacity-0 group-hover:opacity-100 pointer-events-none">
                                {% include "partials/icons/admin/system/icon-admin-arrow-dai-left-xanh.svg" %}
                            </span>
                        </span>
                        <span>Trang trước</span>
                    </button>

                    <button type="button"
                        class="inline-flex items-center justify-center gap-2 px-4 h-[45px] w-[150px] rounded-full bg-blue-900 text-white font-medium hover:bg-blue-800 shrink-0 focus:outline-none focus:ring-2 focus:ring-blue-300 shadow disabled:opacity-50 disabled:cursor-not-allowed"
                        {% if page < total_pages %}
                        hx-get="/admin/models?page={{ page+1 }}&{{ qs_base|trim }}"
                        hx-target="#models-list-region" hx-select="#models-list-region" hx-swap="outerHTML"
                        hx-push-url="true" aria-controls="models-list-region"
                        {% else %} disabled {% endif %}>
                        <span>Trang sau</span>
                        <span class="inline-flex w-[14px] h-[14px] items-center justify-center" aria-hidden="true">
                            {% include "partials/icons/admin/system/icon-admin-arrow-dai-right-trang.svg" %}
                        </span>
                    </button>
                </div>

                <div class="flex items-center gap-3">
                    <form id="models-page-jump-form"
                        class="flex items-center gap-2"
                        hx-get="/admin/models"
                        hx-target="#models-list-region"
                        hx-select="#models-list-region"
                        hx-swap="outerHTML"
                        hx-push-url="true"
                        aria-controls="models-list-region">
                        <input type="hidden" name="status" value="{{ filter_status or 'all' }}">
                        <input type="hidden" name="scope" value="{{ filter_scope or 'any' }}">
                        <input type="hidden" name="tier" value="{{ filter_tier or 'all' }}">
                        <input type="hidden" name="enabled" value="{{ filter_enabled or 'all' }}">
                        <input type="hidden" name="provider" value="{{ filter_provider or '' }}">
                        <input type="hidden" name="type" value="{{ filter_type or '' }}">
                        <input type="hidden" name="q" value="{{ filter_q or '' }}">
                        <input type="hidden" name="sort" value="{{ filter_sort or 'created_desc' }}">

                        <label for="models-page-input" class="sr-only">Trang</label>
                        <input id="models-page-input" name="page" inputmode="numeric" pattern="[0-9]*" type="text"
                            class="pager-input h-[45px]" value="{{ page }}" placeholder="1"
                            minlength="1" maxlength="6"
                            oninput="this.value=this.value.replace(/[^0-9]/g,'');if(this.max){var m=parseInt(this.max,10)||0;var v=parseInt(this.value||'0',10)||0;if(v>m){this.value=String(m);}}"
                            min="1" max="{{ total_pages }}">
                        <input type="hidden" name="per_page" value="{{ per_page or 10 }}">
                        <button type="submit" class="sr-only">Go</button>
                    </form>

                    <div class="inline-flex items-center text-sm">
                        <span class="text-gray-500">of</span>
                        <span class="ml-1 font-semibold text-gray-900">{{ total_pages }}</span>
                    </div>

                    <div class="inline-flex items-center">
                        <button type="button"
                            class="group w-[45px] h-[45px] pg-square ring-1 ring-gray-300 bg-white text-gray-900 hover:text-blue-700 hover:ring-blue-700 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center justify-center shrink-0"
                            aria-label="Trang trước"
                            {% if page>1 %}
                            hx-get="/admin/models?page={{ page-1 }}&{{ qs_base|trim }}"
                            hx-target="#models-list-region" hx-select="#models-list-region"
                            hx-swap="outerHTML" hx-push-url="true"
                            {% else %} disabled {% endif %}>
                            <span class="relative inline-flex w-5 h-5 items-center justify-center" aria-hidden="true">
                                <span class="block">{% include "partials/icons/admin/system/icon-admin-arrow-ngan-left-den.svg" %}</span>
                                <span class="block absolute inset-0 opacity-0 group-hover:opacity-100 pointer-events-none">
                                    {% include "partials/icons/admin/system/icon-admin-arrow-ngan-left-xanh.svg" %}
                                </span>
                            </span>
                        </button>

                        <button type="button"
                            class="group ml-2 w-[45px] h-[45px] pg-square ring-1 ring-gray-300 bg-white text-gray-900 hover:text-blue-700 hover:ring-blue-700 disabled:opacity-50 disabled:cursor-not-allowed inline-flex items-center justify-center shrink-0"
                            aria-label="Trang sau"
                            {% if page < total_pages %}
                            hx-get="/admin/models?page={{ page+1 }}&{{ qs_base|trim }}"
                            hx-target="#models-list-region" hx-select="#models-list-region" hx-swap="outerHTML" hx-push-url="true"
                            {% else %} disabled {% endif %}>
                            <span class="relative inline-flex w-5 h-5 items-center justify-center" aria-hidden="true">
                                <span class="block">{% include "partials/icons/admin/system/icon-admin-arrow-ngan-right-den.svg" %}</span>
                                <span class="block absolute inset-0 opacity-0 group-hover:opacity-100 pointer-events-none">
                                    {% include "partials/icons/admin/system/icon-admin-arrow-ngan-right-xanh.svg" %}
                                </span>
                            </span>
                        </button>
                    </div>
                </div>
            </div>
            <!-- /Pagination -->
        </div>
        {% endif %}
    </div>
    <!-- /LIST REGION -->

    <!-- Bulk bar -->
    <div id="models-bulk-bar" class="bulk-bar" aria-hidden="true" inert data-csrf="{{ csrf_token }}">
        <div class="bulk-inner">
            <div class="bulk-shell">
                <button type="button" id="btn-bulk-enable" class="bulk-btn">
                    <span class="icon">{% include "partials/icons/admin/system/icons_admin_setting_xanh.svg" %}</span>
                    <span class="label" id="bulk-enable-label" aria-live="polite">Bật enabled (0)</span>
                </button>

                <button type="button" id="btn-bulk-disable" class="bulk-btn">
                    <span class="icon">{% include "partials/icons/admin/system/icons_admin_setting_den.svg" %}</span>
                    <span class="label">Tắt enabled</span>
                </button>

                <!-- NEW: Bulk retire -->
                <button type="button" id="btn-bulk-retire" class="bulk-btn">
                    <span class="icon">{% include "partials/icons/admin/system/icons_admin_setting_delete.svg" %}</span>
                    <span class="label">Ngừng dùng</span>
                </button>

                <button type="button" id="btn-bulk-export" class="bulk-btn">
                    <span class="icon">{% include "partials/icons/admin/system/icons_admin_setting_csv_xanh.svg" %}</span>
                    <span class="label">Xuất CSV</span>
                </button>
            </div>
        </div>
    </div>
    <!-- /Bulk bar -->
</div>