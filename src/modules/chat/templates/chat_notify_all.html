<!-- file: src/modules/chat/templates/chat_notify_all.html -->
<!-- updated: 2025-08-16 (v8.5) – Remove hover at day header; no title attrs; keep tooltips only on per-card times (PC) -->
{% extends "partials/chat_base.html" %}
{% block page_title %}TvuMoE - Thông báo{% endblock %}
{% block chat_header %}{% endblock %}

{% block chat_messages %}

<!-- Sticky pseudo-header: full-width, bám trái theo padding <main> -->
<div class="sticky top-0 z-20 w-full">
  <div class="h-[60px] flex items-center -ml-1 select-none">
    <span class="text-lg font-semibold leading-none text-white">Thông báo</span>
  </div>
  <div class="h-px bg-gray-800/70"></div>
</div>

<!-- Timeline container -->
<div class="w-full max-w-[880px] mx-auto px-3">
  <div class="relative grid grid-cols-1 md:grid-cols-[80px_1fr] md:gap-x-6 gap-x-0 gap-y-0 mt-3">
    <!-- Vạch timeline (PC) -->
    <div class="pointer-events-none absolute left-20 inset-y-0 w-px bg-gray-700/80 hidden md:block"></div>
    <span aria-hidden="true" class="absolute z-10 left-20 translate-x-[-4.5px] top-0 -translate-y-1/2 hidden md:block
                 w-2.5 h-2.5 rounded-full bg-gray-300/70 ring-4 ring-[#1F1F1F] pointer-events-none"></span>

    {% if page|default(1) <= 1 %} <!-- Row 1 chỉ hiển thị ở trang 1 -->
      <div class="col-start-1 row-start-1 mt-7 pr-6 justify-end hidden md:flex">
        <div class="relative inline-flex items-center text-right">
          <span class="text-sm font-medium text-gray-400">Hiện tại</span>
          <span aria-hidden="true" class="absolute top-1/2 -translate-y-1/2 left-[calc(100%+24px)] translate-x-[-4.5px] z-10
                     w-2.5 h-2.5 rounded-full bg-gray-300/70 ring-4 ring-[#1F1F1F] pointer-events-none"></span>
        </div>
      </div>
      <div class="col-start-2 row-start-1 items-center mt-7 hidden md:flex">
        <span class="text-sm text-gray-300">Đang cập nhật ...</span>
      </div>
      <div class="md:hidden col-span-1 mt-4 pl-1 text-xs text-gray-400">Hiện tại · Đang cập nhật …</div>
      {% endif %}

      {% if groups and groups|length > 0 %}
      {% for g in groups %}
      <!-- LEFT: block ngày (PC) -->
      <div class="col-start-1 mt-14 pr-6 flex flex-col items-end text-right hidden md:flex">
        <div class="relative inline-flex flex-col items-end text-right">
          <div class="text-4xl font-semibold leading-none tracking-tight text-white -mt-px">{{ g.day }}</div>
          <div class="text-xs text-gray-400 mt-1">{{ g.label }}</div>
          <!-- NOTE: Không hover / tooltip cho time đầu nhóm -->
          <div class="text-[11px] text-gray-500 mt-0.5">{{ g['items'][0].time }}</div>

          <span aria-hidden="true" class="absolute top-1/2 -translate-y-1/2 left-[calc(100%+24px)] translate-x-[-4.5px] z-10
                     w-2.5 h-2.5 rounded-full bg-gray-300/70 ring-4 ring-[#1F1F1F] pointer-events-none"></span>
        </div>
      </div>

      <!-- Group header (Mobile) -->
      <div class="md:hidden col-span-1 mt-8 px-1">
        <div class="flex items-end gap-2">
          <div class="text-3xl font-semibold leading-none text-white">{{ g.day }}</div>
          <div class="flex flex-col leading-tight">
            <span class="text-xs text-gray-400">{{ g.label }}</span>
            <span class="text-[11px] text-gray-500">{{ g['items'][0].time }}</span>
          </div>
        </div>
      </div>

      <!-- Card đầu tiên -->
      {% set item = g['items'][0] %}
      <div class="col-span-1 md:col-start-2 mt-3 md:mt-14">
        <article class="rounded-3xl bg-[#2A2A2A] p-5 md:p-6 shadow-xl overflow-hidden">
          <div class="flex items-center justify-between pb-4 w-[99%] mx-auto">
            <div>
              <h3 class="text-[16px] font-semibold leading-tight text-white">{{ item.sender_name }}</h3>
              <p class="text-xs text-gray-400 mt-0.5">{{ item.sender_title }}</p>
            </div>
            <img src="{{ item.sender_avatar_url }}" alt="{{ item.sender_name }}"
              class="h-10 w-10 rounded-full object-cover ring-2 ring-gray-700/70" />
          </div>
          <div class="mt-3 rounded-2xl bg-[#242424] p-4 md:p-5">
            <div class="mb-3 text-sm font-semibold text-gray-200">Thông báo</div>
            <div
              class="rounded-2xl bg-[#1F1F1F] p-4 md:p-5 text-sm leading-7 text-gray-300 ring-1 ring-gray-800/60 text-justify space-y-4">
              {% if item.paragraphs and item.paragraphs|length > 0 %}
              {% for p in item.paragraphs %}<p>{{ p }}</p>{% endfor %}
              {% else %}<p>Không có nội dung.</p>{% endif %}
            </div>
          </div>
        </article>
      </div>

      <!-- Các card còn lại trong cùng ngày -->
      {% if g['items']|length > 1 %}
      {% for item in g['items'][1:] %}
      <!-- trái: giờ + dot (PC) -->
      <div class="col-start-1 mt-4 pr-6 hidden md:block">
        <div class="relative h-full flex items-center justify-end">
          <!-- Tooltip PC: KHÔNG dùng title; chỉ aria-label + bubble -->
          <span class="group relative inline-flex items-center text-[11px] text-gray-500" tabindex="0"
            aria-label="{{ g.day }} / {{ g.full_date }} / {{ item.time }}">
            {{ item.time }}
            <!-- Tooltip bubble -->
            <span class="pointer-events-none absolute right-full mr-2 top-1/2 -translate-y-1/2 opacity-0
                           group-hover:opacity-100 group-focus:opacity-100 transition-opacity duration-150">
              <span
                class="block rounded-md bg-[#1F1F1F] border border-gray-700 px-2 py-1 text-xs text-gray-200 shadow-lg whitespace-nowrap">
                <span class="font-semibold text-gray-100">{{ g.day }}</span>
                <span class="mx-1 text-gray-500">/</span>
                <span>{{ g.full_date }}</span>
                <span class="mx-1 text-gray-500">/</span>
                <span>{{ item.time }}</span>
              </span>
              <!-- Arrow -->
              <span
                class="absolute right-[-4px] top-1/2 -translate-y-1/2 w-2 h-2 rotate-45 bg-[#1F1F1F] border-r border-b border-gray-700"></span>
            </span>
          </span>

          <!-- DOT -->
          <span aria-hidden="true" class="absolute top-1/2 -translate-y-1/2 left-[calc(100%+24px)] translate-x-[-4.5px] z-10
                     w-2.5 h-2.5 rounded-full bg-gray-300/70 ring-4 ring-[#1F1F1F] pointer-events-none"></span>
        </div>
      </div>

      <!-- Card -->
      <div class="col-span-1 md:col-start-2 mt-3 md:mt-4">
        <article class="rounded-3xl bg-[#2A2A2A] p-5 md:p-6 shadow-xl overflow-hidden">
          <div class="flex items-center justify-between pb-4 w-[99%] mx-auto">
            <div>
              <h3 class="text-[16px] font-semibold leading-tight text-white">{{ item.sender_name }}</h3>
              <p class="text-xs text-gray-400 mt-0.5">{{ item.sender_title }}</p>
              <div class="md:hidden text-[11px] text-gray-500 mt-0.5">{{ item.time }}</div>
            </div>
            <img src="{{ item.sender_avatar_url }}" alt="{{ item.sender_name }}"
              class="h-10 w-10 rounded-full object-cover ring-2 ring-gray-700/70" />
          </div>
          <div class="mt-3 rounded-2xl bg-[#242424] p-4 md:p-5">
            <div class="mb-3 text-sm font-semibold text-gray-200">Thông báo</div>
            <div
              class="rounded-2xl bg-[#1F1F1F] p-4 md:p-5 text-sm leading-7 text-gray-300 ring-1 ring-gray-800/60 text-justify space-y-4">
              {% if item.paragraphs and item.paragraphs|length > 0 %}
              {% for p in item.paragraphs %}<p>{{ p }}</p>{% endfor %}
              {% else %}<p>Không có nội dung.</p>{% endif %}
            </div>
          </div>
        </article>
      </div>
      {% endfor %}
      {% endif %}
      {% endfor %}
      {% else %}
      <div class="col-span-1 md:col-start-2 mt-8 md:mt-14">
        <div class="rounded-2xl bg-[#2A2A2A] p-6 text-sm text-gray-300">Chưa có thông báo.</div>
      </div>
      {% endif %}
  </div>

  <!-- Pagination: canh đúng bề rộng cột card (PC), giữa màn hình (mobile) -->
  {% if total_pages and total_pages > 1 %}
  <div class="mt-8 mb-6 md:ml-[104px] md:w-[calc(100%-104px)]">
    <nav class="w-full mx-auto flex items-center justify-center gap-3 select-none">
      {% if has_prev %}
      <a href="/chat/notify/all?page={{ prev_page }}" hx-get="/chat/notify/all?page={{ prev_page }}"
        hx-target="#chat-root" hx-select="#chat-root" hx-swap="outerHTML" hx-push-url="true" class="w-9 h-9 rounded-2xl border border-gray-700 bg-[#2A2A2A] hover:bg-[#303030] transition-colors
                flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-gray-600/40
                [&>svg]:w-3 [&>svg]:h-3" aria-label="Trang trước">
        {% include "partials/icons/chat_notify_all/icon_chat_notify_arrow_left.svg" %}
      </a>
      {% else %}
      <span class="w-9 h-9 rounded-2xl border border-gray-800 bg-[#1F1F1F] opacity-40
                   flex items-center justify-center [&>svg]:w-3 [&>svg]:h-3" aria-hidden="true">
        {% include "partials/icons/chat_notify_all/icon_chat_notify_arrow_left.svg" %}
      </span>
      {% endif %}

      <span class="text-sm text-gray-300">Trang {{ page }} of {{ total_pages }}</span>

      {% if has_next %}
      <a href="/chat/notify/all?page={{ next_page }}" hx-get="/chat/notify/all?page={{ next_page }}"
        hx-target="#chat-root" hx-select="#chat-root" hx-swap="outerHTML" hx-push-url="true" class="w-9 h-9 rounded-2xl border border-gray-700 bg-[#2A2A2A] hover:bg-[#303030] transition-colors
                flex items-center justify-center focus:outline-none focus:ring-2 focus:ring-gray-600/40
                [&>svg]:w-3 [&>svg]:h-3" aria-label="Trang sau">
        {% include "partials/icons/chat_notify_all/icon_chat_notify_arrow_right.svg" %}
      </a>
      {% else %}
      <span class="w-9 h-9 rounded-2xl border border-gray-800 bg-[#1F1F1F] opacity-40
                   flex items-center justify-center [&>svg]:w-3 [&>svg]:h-3" aria-hidden="true">
        {% include "partials/icons/chat_notify_all/icon_chat_notify_arrow_right.svg" %}
      </span>
      {% endif %}
    </nav>
  </div>
  {% endif %}

</div>
{% endblock %}